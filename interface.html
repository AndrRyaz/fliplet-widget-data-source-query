<form id="app" v-cloak class="container-fluid">
  <!--<pre v-if="selectedDataSource">result: \{{ result | json }}</pre>-->
  <div class="form-group row">
    <div class="col-sm-4 control-label">
      <label>{{settings.dataSourceLabel}}</label>
    </div>
    <div class="col-sm-8">
      <label class="select-proxy-display">
        <span class="icon fa fa-chevron-down"></span>
        <select data-label="select" class="hidden-select form-control" v-model="selectedDataSource"
                v-on:change="onDataSourceSelection" :disabled="!dataSources">
          <option :value="null">-- \{{ dataSources ? 'Select a data source' : 'Please wait' }}</option>
          <option :value="dataSource" v-for="dataSource in dataSources">\{{dataSource.name}}</option>
        </select>
      </label>
    </div>
  </div>

  <div class="row container-fluid">
    <div v-for="field in columns" class="row">
      <div class="col-sm-4 control-label">
        <label>\{{field.label}}</label>
      </div>
      <div class="col-sm-8">
        <label class="select-proxy-display" v-if="field.type === 'single'">
          <span class="icon fa fa-chevron-down"></span>
          <select v-if="selectedDataSource && selectedDataSource.columns && selectedDataSource.columns.length"
                  data-label="select" class="hidden-select form-control" v-model="selectedColumns[field.key]"
                  v-on:change="updateSelectedColumns(field.key, $event.target.value)">
            <option :value="undefined">-- \{{field.label}}</option>
            <option :value="column" v-for="column in selectedDataSource.columns">
              \{{column}}
            </option>
          </select>
          <select v-if="!selectedDataSource || !selectedDataSource.columns || !selectedDataSource.columns.length"
                  data-label="select" class="hidden-select form-control" disabled="disabled">
            <option> \{{columnWarning}}</option>
          </select>
        </label>
        <label class="full-width" v-if="field.type === 'multiple'">
          <span v-if="selectedDataSource && selectedDataSource.columns && selectedDataSource.columns.length">
            <tagsinput :tagsinput-data="typeaheadData" :field="field" :init-arr="selectedColumns[field.key]"
                       :update-selected-columns="updateSelectedColumns"></tagsinput>
          </span>
          <input v-if="!selectedDataSource || !selectedDataSource.columns || !selectedDataSource.columns.length"
                 class="form-control height-30" type="text" disabled="disabled" :value="columnWarning"/>
        </label>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-4"></div>
      <div class="col-sm-8">
        <div class="checkbox checkbox-icon pull-left">
          <input type="checkbox" id="apply-filter" v-model="applyFilters"
                 :disabled="!selectedDataSource || !selectedDataSource.columns || !selectedDataSource.columns.length"/>
          <label for="apply-filter">
            <span class="check">
              <i class="fa fa-check"></i>
            </span>
            Apply filter
          </label>
        </div>
        <div class="pull-right">
          <span v-if="showFilters" class="btn btn-link" v-on:click="showFilters = false">Hide filters​</span>
          <span v-if="!showFilters && filters.length && dataSources" class="btn btn-link"
                v-on:click="showFilters = true">Show filters​</span>
        </div>
      </div>
    </div>

    <div class="form-group row filter container-fluid" v-for="(filter, index) in filters" v-if="showFilters">
      <div class="row">
        <div class="col-sm-4 control-label"></div>
        <div class="col-sm-8">
          <label class="select-proxy-display">
            <span class="icon fa fa-chevron-down"></span>
            <select data-label="select" class="hidden-select form-control" v-model="filter.column">
              <option :value="column" v-for="column in selectedDataSource.columns">\{{column}}</option>
            </select>
          </label>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4 control-label"></div>
        <div class="col-sm-8">
          <label class="select-proxy-display">
            <span class="icon fa fa-chevron-down"></span>
            <select data-label="select" class="hidden-select form-control" v-model="filter.operator">
              <option :value="operator" v-for="operator in operators">\{{operator}}</option>
            </select>
          </label>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4 control-label"></div>
        <div class="col-sm-8">
          <input type="text" class="form-control" v-model="filter.value"/>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4 control-label"></div>
        <div class="col-sm-8">
          <div class="checkbox checkbox-icon">
            <input type="checkbox" :id="'ignore-case-' + index" v-model="filter.ignoreCase"/>
            <label :for="'ignore-case-' + index">
              <span class="check">
                <i class="fa fa-check"></i>
              </span>
              Ignore case
            </label>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-4 control-label"></div>
        <div class="col-sm-8">
          <div class="icon fa fa-minus grey-icon-button pull-left" v-on:click="filters.splice(index, 1)"></div>
          <div v-if="index === (filters.length - 1)" class="icon fa fa-plus blue-icon-button pull-right"
               v-on:click="addDefaultFilter"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="centered-modal" v-if="loadingError">
    <div>
      <div>Error retrieving data configuration.</div>
      <br/>
      <div class="text-center">
        <span class="btn btn-primary" v-on:click="getDataSources()">Try again</span>
      </div>
    </div>
  </div>
</form>